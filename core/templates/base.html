{% load static socialaccount %}
<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}{% if system_settings.seo_title %}{{ system_settings.seo_title }}{% else %}{{ system_settings.site_name|default:"متجرك الإلكتروني" }}{% endif %}{% endblock %}</title>
    
    <!-- Dynamic SEO Tags -->
    <meta name="description" content="{% block meta_description %}{{ system_settings.seo_description|default:system_settings.description }}{% endblock %}">
    {% if system_settings.seo_keywords %}
    <meta name="keywords" content="{{ system_settings.seo_keywords }}">
    {% endif %}
    
    {% block extra_meta %}{% endblock %}
    
    <!-- Favicon -->
    <link rel="icon" type="image/png" href="{% static 'logo.png' %}">
    
    <!-- CSS Libraries -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">
    <link href="https://unpkg.com/nprogress@0.2.0/nprogress.css" rel="stylesheet">
    <script src="https://unpkg.com/nprogress@0.2.0/nprogress.js"></script>
    <script>NProgress.configure({ showSpinner: true, trickleSpeed: 200 });</script>

    <!-- Arabic web fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&family=Tajawal:wght@300;400;700;900&display=swap" rel="stylesheet">

    <link rel="dns-prefetch" href="//cdn.jsdelivr.net">
    <link rel="dns-prefetch" href="//cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://cdn.jsdelivr.net" crossorigin>
    <link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin>


    {% comment %} <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0"> {% endcomment %}

    <!-- Custom CSS -->
    <link rel="stylesheet" href="{% static 'css/theme.css' %}?v={{ css_version }}">
    <link rel="stylesheet" href="{% static 'css/components.css' %}?v={{ css_version }}">
    <link rel="stylesheet" href="{% static 'css/animations.css' %}?v={{ css_version }}">
    <link rel="stylesheet" href="{% static 'css/bottom_nav.css' %}?v={{ css_version }}">
    
    <!-- Main Base CSS (Extracted) -->
    <link rel="stylesheet" href="{% static 'css/main_base.css' %}?v={{ css_version }}">

    <style>
        :root {
            /* Brand Core */
            --primary-color: {{ supplier.primary_color|default:'#ef7d2d' }};
            --secondary-color: {{ supplier.secondary_color|default:'#ffffff' }};
            --accent-color: {{ supplier.accent_color|default:'#9abfc4' }};
            --text-color: {{ supplier.text_color|default:'#3a505e' }};

            /* Layout Colors */
            --navbar-bg: {{ supplier.navbar_color|default:'#ef7d2d' }};
            --footer-bg: {{ supplier.footer_color|default:'#3a505e' }};

            /* Accent & Highlights */
            --success-color: #22c55e;
            --warning-color: #fbbf24;
            --danger-color: #ef4444;

            /* Neutrals */
            --dark-color: #111827;
            --light-color: #f9fafb;

            /* Visual Effects - Solidified based on feedback */
            --glass-bg: rgba(255, 255, 255, 0.95);
            --glass-border: rgba(255, 255, 255, 0.2);
            --shadow-light: 0 4px 20px rgba(0, 0, 0, 0.08); 
            --shadow-dark: 0 8px 32px rgba(0, 0, 0, 0.15);

            /* Dynamic Background */
            --body-bg-gradient: linear-gradient(135deg, {{ supplier.primary_color|default:'#ef7d2d' }}1A 0%, {{ supplier.secondary_color|default:'#ffffff' }}1A 100%);
        }

        }
    </style>
    
    {% block extra_css %}{% endblock %}
</head>
    <body class="flex flex-col min-h-screen overflow-x-hidden">
    <script>
        // Site Configuration for main_base.js
        window.siteConfig = {
            isAuthenticated: {% if user.is_authenticated %}true{% else %}false{% endif %},
            addToCartUrl: "{% url 'add_to_cart' product_id=0 store_id='STORE_ID' %}",
            subToCartUrl: "{% url 'sub_to_cart' product_id=0 store_id='STORE_ID' %}",
            estimatedFee: "{{ estimated_fee|default:0 }}",
            csrfToken: "{{ csrf_token }}"
        };
    </script>
    <script>NProgress.start();</script>
    <!-- Page Loader -->
    <div id="page-loader">
        <div class="loader-content">
            <div class="loader-ring"></div>
            <div class="loader-logo-container">
                {% if system_settings.laoder_image %}
                    <img src="{{ system_settings.laoder_image.url }}" alt="{{ system_settings.site_name }}" class="h-24 w-auto loader-logo">
                {% elif supplier.profile_picture %}
                    <img src="{{ supplier.profile_picture.url }}" alt="{{ supplier.name }}" class="h-24 w-auto loader-logo">
                {% else %}
                    {% if system_settings.logo %}
                        <img src="{{ system_settings.logo.url }}" alt="{{ system_settings.site_name }}" class="h-24 w-auto loader-logo">
                    {% else %}
                        <img src="{% static 'logo.png' %}" alt="{{ system_settings.site_name|default:'متجرك' }}" class="h-24 w-auto loader-logo">
                    {% endif %}
                {% endif %}
                <div class="logo-glimmer"></div>
            </div>
        </div>
    </div>
    <!-- Login Modal -->
    <div id="loginModal" class="fixed inset-0 z-[2000000] hidden" style="z-index: 9999999 !important;" aria-labelledby="modal-title" role="dialog" aria-modal="true">
        <div class="flex items-center justify-center min-h-screen p-4 text-center">
            <div class="fixed inset-0 bg-gray-900 bg-opacity-60 backdrop-blur-sm transition-opacity" aria-hidden="true" onclick="closeLoginModal()"></div>
            
            <div class="rounded-[32px] text-right overflow-hidden transform transition-all w-full max-w-[420px] max-h-[calc(100dvh-2rem)] flex flex-col modal-glass animate-modal-fade relative z-10 shadow-2xl">
                
                <!-- Logo Header -->
                <div class="pt-8 pb-2 text-center flex-shrink-0">
                    <div class="flex items-center justify-center gap-3">
                        {% if supplier.profile_picture %}
                            <div class="w-14 h-14 rounded-2xl bg-white shadow-lg p-2 flex items-center justify-center transform -rotate-3 hover:rotate-0 transition-all border border-gray-50">
                                <img src="{{ supplier.profile_picture.url }}" alt="{{ supplier.name }}" class="w-full h-full object-contain">
                            </div>
                        {% endif %}
                        
                        {% if supplier.profile_picture and system_settings.logo or system_settings.logo or not supplier.profile_picture %}
                            <div class="w-14 h-14 rounded-2xl bg-white shadow-lg p-2 flex items-center justify-center transform rotate-3 hover:rotate-0 transition-all border border-gray-50">
                                {% if system_settings.logo %}
                                    <img src="{{ system_settings.logo.url }}" alt="{{ system_settings.site_name }}" class="w-full h-full object-contain">
                                {% else %}
                                    <img src="{% static 'logo.png' %}" alt="{{ system_settings.site_name|default:'متجرك' }}" class="w-full h-full object-contain">
                                {% endif %}
                            </div>
                        {% endif %}
                    </div>
                </div>

                <!-- Scrollable Body -->
                <div class="px-6 py-4 flex-grow overflow-y-auto custom-scrollbar">
                    
                    <!-- New Refined Tab Switcher -->
                    <div class="flex gap-2 mb-4">
                        <button onclick="switchLoginTab('client')" id="tab-client" class="tab-card active flex-1 flex flex-col items-center justify-center p-3 rounded-2xl border-2 transition-all">
                            <div class="icon-box transition-colors scale-90 -mb-2">
                                <i class="fas fa-user-tie text-lg text-gray-400"></i>
                            </div>
                            <span class="text-[10px] font-bold text-gray-400">العملاء</span>
                        </button>
                        <button onclick="switchLoginTab('merchant')" id="tab-merchant" class="tab-card flex-1 flex flex-col items-center justify-center p-3 rounded-2xl border-2 transition-all">
                            <div class="icon-box transition-colors scale-90 -mb-2">
                                <i class="fas fa-store text-lg text-gray-400"></i>
                            </div>
                            <span class="text-[10px] font-bold text-gray-400">التجار</span>
                        </button>
                    </div>

                    <!-- Client Login -->
                    <div id="client-login-content" class="text-center fade-in-section">
                        <h3 class="text-sm font-bold text-gray-900 mb-4" id="modal-title">مرحباً بعودتك.. قم بتسجيل الدخول</h3>
                        
                        <form id="unifiedAuthForm" class="space-y-4 text-right">
                            <!-- Google Login -->
                            <a href="{% provider_login_url 'google' %}" class="w-full text-xs font-bold text-gray-700 hover:bg-gray-50 bg-white py-4 rounded-2xl transition-all flex items-center justify-center gap-3 border border-gray-100 mb-1 shadow-sm">
                                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" class="w-4 h-4" alt="Google Logo">
                                <span>المتابعة باستخدام Google</span>
                            </a>

                            <div class="relative flex py-1 items-center">
                                <div class="flex-grow border-t border-gray-50"></div>
                                <span class="flex-shrink-0 mx-3 text-gray-300 text-[10px] font-bold">أو برقم الهاتف</span>
                                <div class="flex-grow border-t border-gray-50"></div>
                            </div>

                            <div class="floating-field-wrapper" dir="ltr">
                                <div class="absolute inset-y-0 left-0 pl-4 flex items-center pointer-events-none text-gray-700 font-bold text-xs border-r border-gray-100 pr-3 my-3 bg-gray-50/20 rounded-l-xl z-20">
                                    +967
                                </div>
                                <input type="tel" name="phone" id="auth_phone" required 
                                    maxlength="9"
                                    onkeypress="return event.charCode >= 48 && event.charCode <= 57"
                                    oninput="this.value = this.value.replace(/[^0-9]/g, ''); handlePhoneValidation(this);"
                                    class="block w-full pl-20 pr-4 py-3.5 rounded-2xl text-gray-900 text-left input-premium outline-none text-sm font-medium">
                                <label class="floating-label">رقم الموبايل</label>
                            </div>
                            <p id="phone-validation-msg" class="text-[10px] text-red-500 mt-1 hidden"></p>

                            <!-- Privacy Policy Checkbox (Client Only) -->
                            <div class="flex items-center gap-2 mt-4 justify-start">
                                <input type="checkbox" id="privacy_policy_checkbox" class="w-4 h-4 rounded border-gray-300 text-[var(--primary-color)] cursor-pointer">
                                <label for="privacy_policy_checkbox" class="text-[10px] text-gray-500 font-medium cursor-pointer">
                                    أوافق على <a href="{% url 'privacy_policy' %}" class="text-[var(--primary-color)] hover:underline" onclick="event.stopPropagation()">سياسة الخصوصية</a>
                                </label>
                            </div>
                        </form>
                    </div>

                    <!-- Merchant Login -->
                    <div id="merchant-login-content" class="hidden text-center fade-in-section">
                        <form id="merchantAuthForm" class="space-y-4 text-right pt-2 border-t border-gray-50">
                            <div class="floating-field-wrapper">
                                <input id="merchant_username" name="username" type="text" required 
                                    class="w-full px-4 py-3.5 rounded-2xl input-premium text-sm">
                                <label class="floating-label">اسم المستخدم</label>
                            </div>
                            
                            <div class="floating-field-wrapper">
                                <input id="merchant_password" name="password" type="password" required 
                                    class="w-full px-4 py-3.5 rounded-2xl input-premium text-sm pl-12 text-left" dir="ltr">
                                <label class="floating-label">كلمة المرور</label>
                                <button type="button" class="absolute left-0 inset-y-0 px-4 flex items-center text-gray-400" onclick="togglePasswordVisibility('merchant_password', 'merchant_pw_icon')">
                                    <i id="merchant_pw_icon" class="fas fa-eye text-xs"></i>
                                </button>
                            </div>
                            <button type="button" onclick="togglePasswordReset(true)" class="text-[10px] font-bold text-[var(--primary-color)] hover:underline mt-2 inline-block">نسيت كلمة المرور؟</button>
                        </form>

                        <div id="password-reset-content" class="hidden space-y-4 text-right fade-in-section mt-4">
                            <div class="h-px bg-gray-100 w-full mb-4"></div>
                            <h4 class="text-sm font-bold text-gray-800 text-center mb-2">استعادة الحساب</h4>
                            <div id="reset-status-container" class="hidden mb-4 rounded-xl p-3 text-right bg-blue-50 text-blue-700 text-[11px] border border-blue-100"></div>
                            
                            <div id="reset-form-content" class="space-y-4">
                                <div class="floating-field-wrapper">
                                    <input id="reset_username" type="text" class="w-full px-4 py-3.5 rounded-2xl input-premium text-sm">
                                    <label class="floating-label">البيانات (اسم المستخدم أو الهاتف)</label>
                                </div>
                                <button type="button" id="reset-submit-btn" onclick="handlePasswordResetRequest()" class="w-full py-3.5 bg-gray-900 text-white rounded-2xl font-bold text-xs hover:bg-black transition-all flex items-center justify-center">تحقق من الحساب</button>
                                <div class="flex flex-col gap-2 text-center mt-2">
                                    <button type="button" onclick="handlePasswordResetRequest(true)" class="text-[10px] font-bold text-gray-400 hover:text-[var(--primary-color)]">نسيت كل البيانات؟</button>
                                    <button type="button" onclick="togglePasswordReset(false)" class="text-[10px] font-bold text-gray-500 underline">العودة لتسجيل الدخول</button>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-6 pb-2">
                            <a href="{% url 'join_business' %}" class="text-[10px] font-bold text-[var(--primary-color)] hover:underline">
                                ليس لديك حساب تجاري؟ انضم إلينا الآن
                            </a>
                        </div>
                    </div>
                </div>

                <!-- Fixed Footer -->
                <div class="p-4 bg-gray-50/50 border-t border-gray-100 flex-shrink-0">
                    <div id="loginError" class="hidden mb-3 p-3 bg-red-50 border border-red-100 rounded-xl flex items-center gap-3 animate-shake">
                        <i class="fas fa-exclamation-circle text-red-500 text-sm"></i>
                        <p class="error-text text-[10px] text-red-600 font-bold text-right flex-1"></p>
                    </div>

                    <div class="flex gap-3">
                        <button onclick="closeLoginModal()" class="flex-1 py-3.5 bg-white border border-gray-200 text-gray-500 rounded-2xl font-bold text-xs hover:bg-gray-50 transition-all whitespace-nowrap flex items-center justify-center">
                            إلغاء
                        </button>
                        <button id="authSubmitBtn" onclick="handleLoginSubmit()" class="flex-1 py-3.5 text-white rounded-2xl font-bold text-xs shadow-lg shadow-orange-200/50 hover:brightness-105 transition-all whitespace-nowrap flex items-center justify-center" style="background-color: var(--primary-color) !important;">
                            متابعة
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <!-- Navigation Bar -->
    <nav class="curved-navbar fixed inset-x-0 top-0 z-50 py-2 transition-all duration-300">
        <div class="container mx-auto px-4 relative h-16 sm:h-20 flex items-center justify-between">
            
            <!-- Right: Cart Orb (Start of flex in RTL) -->
            <div class="flex items-center w-24 justify-start">
                {% if user.is_authenticated and cart and supplier %}
                    <a href="{% url 'cart-detail' supplier.store_id %}" class="nav-orb relative group">
                        <i class="fas fa-shopping-basket text-xl"></i>
                        <!-- Badge -->
                        <span id="total-items" class="absolute -top-1 -right-1 bg-gradient-to-br from-red-500 to-red-600 text-white text-[10px] font-bold rounded-full min-w-[20px] h-5 inline-flex items-center justify-center px-1 border-2 border-white shadow-sm transform group-hover:scale-110 transition-transform">
                            {{ cart.get_total_items }}
                        </span>
                    </a>
                {% else %}
                     <a href="#" class="nav-orb opacity-40 cursor-not-allowed">
                        <i class="fas fa-shopping-basket text-xl"></i>
                    </a>
                {% endif %}
            </div>

            <!-- Left: User Menu Orb (End of flex in RTL) -->
            <div class="flex items-center w-24 justify-end">
                {% if user.is_authenticated %}
                    <div class="relative group">
                        <a href="{% url 'user_profile' %}" class="nav-orb">
                            <i class="fas fa-user text-xl"></i>
                        </a>
                    </div>
                {% else %}
                    <div class="relative group">
                        <button onclick="openLoginModal()" class="nav-orb">
                            <i class="fas fa-user text-xl"></i>
                        </button>
                    </div>
                {% endif %}
            </div>
        </div>

        <!-- Center: Premium Logo Orb (Sitting on the curve) -->
        <a href="/" class="absolute left-1/2 bottom-0 transform -translate-x-1/2 translate-y-1/2 z-20">
            <div class="logo-orb-wrapper {% if supplier and supplier.show_system_logo %}logo-dual{% endif %}">
                {% if supplier %}
                    <!-- Supplier Logo -->
                    <img src="{% if supplier.profile_picture %}{{ supplier.profile_picture.url }}{% else %}{% static 'logo.png' %}{% endif %}" alt="{{ supplier.name }}">
                    
                    {% if supplier.show_system_logo %}
                        <div class="logo-separator"></div>
                        <!-- System Logo (Companion) -->
                        <img src="{% if system_settings.logo %}{{ system_settings.logo.url }}{% else %}{% static 'logo.png' %}{% endif %}" alt="{{ system_settings.site_name }}">
                    {% endif %}
                {% else %}
                    <!-- Global System Logo -->
                    <img src="{% if system_settings.logo %}{{ system_settings.logo.url }}{% else %}{% static 'logo.png' %}{% endif %}" alt="{{ system_settings.site_name|default:'متجرك' }}">
                {% endif %}
            </div>
        </a>
    </nav>
    
    <!-- Main Content -->
    <main class="main-content flex-grow w-full pt-20 lg:pt-28 overflow-x-hidden">
        {% if messages %}
        <!-- Server-side Messages Wrapper -->
        <div class="fixed top-24 left-4 right-4 md:left-auto md:right-6 md:w-auto md:max-w-sm flex flex-col space-y-2 pointer-events-none" style="z-index: 99999;">
            {% for message in messages %}
            <div class="pointer-events-auto rounded-xl shadow-lg text-white transform transition-all duration-300 ease-out flex items-stretch overflow-hidden animate-slide-in-message"
                 style="background-color: #ffffff; color: #333; z-index: 9999; backdrop-filter: blur(12px); border: 1px solid rgba(255,255,255,0.4);
                 {% if message.tags == 'success' %}border-left: 6px solid var(--success-color);{% elif message.tags == 'error' %}border-left: 6px solid var(--danger-color);{% elif message.tags == 'warning' %}border-left: 6px solid var(--warning-color);{% else %}border-left: 6px solid var(--primary-color);{% endif %}">
                
                <div class="flex items-center p-3 md:p-4 w-full" style="background-color: rgba(255, 255, 255, 0.8);">
                    <div class="flex-shrink-0 ml-3">
                        {% if message.tags == 'success' %}
                            <i class="fas fa-check-circle text-xl md:text-2xl" style="color: var(--success-color)"></i>
                        {% elif message.tags == 'error' %}
                            <i class="fas fa-exclamation-circle text-xl md:text-2xl" style="color: var(--danger-color)"></i>
                        {% elif message.tags == 'warning' %}
                            <i class="fas fa-exclamation-triangle text-xl md:text-2xl" style="color: var(--warning-color)"></i>
                        {% else %}
                            <i class="fas fa-info-circle text-xl md:text-2xl" style="color: var(--primary-color)"></i>
                        {% endif %}
                    </div>
                    <div class="flex-1 mr-2">
                        <p class="text-sm md:text-base font-bold text-gray-800 leading-tight">{{ message }}</p>
                    </div>
                    <button onclick="this.closest('div').remove()" class="mr-3 text-gray-400 hover:text-gray-600 transition-colors">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>
            {% endfor %}
        </div>
        {% endif %}

        {% block content %}{% endblock %}
    </main>

    {% block footer %}
    <!-- Footer -->
    <footer class="footer-main py-6 border-t border-gray-100 bg-white">
        <div class="container mx-auto px-6">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8">
                <!-- Branding -->
                <div class="space-y-3">
                    <div class="flex items-center gap-4">
                        {% if supplier %}
                            <!-- Supplier Logo -->
                            {% if supplier.profile_picture %}
                                <img src="{{ supplier.profile_picture.url }}" alt="{{ supplier.name }}" class="h-12 w-auto object-contain" loading="lazy">
                            {% else %}
                                <span class="text-xl font-bold text-gray-800">{{ supplier.name }}</span>
                            {% endif %}

                            <!-- Union Separator -->
                            <div class="h-8 w-px bg-gray-300"></div>

                            <!-- System/Platform Logo (Powered By) -->
                            {% if system_settings.logo %}
                                <img src="{{ system_settings.logo.url }}" alt="{{ system_settings.site_name }}" class="h-8 w-auto grayscale opacity-70 hover:grayscale-0 hover:opacity-100 transition-all duration-300" title="Powered by {{ system_settings.site_name }}" loading="lazy">
                            {% else %}
                                <span class="text-sm font-bold text-gray-500">{{ system_settings.site_name }}</span>
                            {% endif %}
                        {% elif system_settings.logo %}
                            <!-- System Logo Only (Platform Mode) -->
                            <img src="{{ system_settings.logo.url }}" alt="{{ system_settings.site_name }}" class="h-10 w-auto" loading="lazy">
                        {% else %}
                            <i class="fas fa-store text-xl text-[var(--primary-color)]"></i>
                            <h3 class="text-xl font-black text-gray-900">{{ system_settings.site_name|default:"متجرك" }}</h3>
                        {% endif %}
                    </div>
                    <p class="text-gray-500 text-xs leading-relaxed">{{ system_settings.description|default:"منصة متكاملة توفر لك تجربة تسوق فريدة ومميزة." }}</p>
                    <div class="flex space-x-3 space-x-reverse">
                        {% if system_settings.twitter_url %}
                        <a href="{{ system_settings.twitter_url }}" class="text-gray-400 hover:text-blue-500 transition-colors"><i class="fab fa-twitter text-lg"></i></a>
                        {% endif %}
                        {% if system_settings.instagram_url %}
                        <a href="{{ system_settings.instagram_url }}" class="text-gray-400 hover:text-pink-500 transition-colors"><i class="fab fa-instagram text-lg"></i></a>
                        {% endif %}
                        {% if system_settings.whatsapp_number %}
                        <a href="https://wa.me/{{ system_settings.whatsapp_number }}" class="text-gray-400 hover:text-green-500 transition-colors"><i class="fab fa-whatsapp text-lg"></i></a>
                        {% endif %}
                    </div>
                </div>

                <!-- Shopping -->
                <div>
                    <h4 class="font-bold text-gray-800 text-sm mb-3">روابط مهمة</h4>
                    <ul class="space-y-2 text-xs text-gray-500">
                        <li><a href="#" class="hover:text-brand-primary transition-colors">من نحن</a></li>
                        <li><a href="#" class="hover:text-brand-primary transition-colors">الشروط والأحكام</a></li>
                        <li><a href="{% url 'privacy_policy' %}" class="hover:text-brand-primary transition-colors">سياسة الخصوصية</a></li>
                        <li><a href="#" class="hover:text-brand-primary transition-colors">سياسة الاستبدال والاسترجاع</a></li>
                    </ul>
                </div>

                <!-- Support -->
                <div>
                    <h4 class="font-bold text-gray-800 text-sm mb-3">تواصل معنا</h4>
                    <ul class="space-y-2 text-xs text-gray-500">
                        <li class="flex items-center">
                            <i class="fas fa-envelope ml-2 text-gray-300"></i>
                            <span>{{ system_settings.company_email|default:"support@store.com" }}</span>
                        </li>
                        <li class="flex items-center">
                            <i class="fas fa-phone-alt ml-2 text-gray-300"></i>
                            <span dir="ltr">{{ system_settings.customer_service_number|default:"+966 50 123 4567" }}</span>
                        </li>
                        {% if system_settings.company_landline %}
                        <li class="flex items-center">
                            <i class="fas fa-phone ml-2 text-gray-300"></i>
                            <span dir="ltr">{{ system_settings.company_landline }}</span>
                        </li>
                        {% endif %}
                        {% if system_settings.whatsapp_number %}
                        <li class="mt-2">
                            <a href="https://wa.me/{{ system_settings.whatsapp_number }}" class="inline-flex items-center px-3 py-1 bg-green-500 text-white rounded-lg hover:bg-green-600 transition-all font-bold text-xs">
                                <i class="fab fa-whatsapp ml-1"></i> الدعم عبر واتساب
                            </a>
                        </li>
                        {% endif %}
                    </ul>
                </div>

                <!-- Apps & Trust -->
                {% if system_settings.show_download_app %}
                <div>
                    <h4 class="font-bold text-gray-800 text-sm mb-3">تطبيقات المتجر</h4>
                    <div class="space-y-2">
                        {% if system_settings.app_store_link %}
                        <a href="{{ system_settings.app_store_link }}" class="block w-full bg-gray-900 text-white rounded-lg px-4 py-2 flex items-center hover:bg-gray-800 transition-colors">
                            <i class="fab fa-apple text-xl ml-3"></i>
                            <div class="text-right">
                                <div class="text-[10px] leading-none text-gray-400">حمل من</div>
                                <div class="font-bold text-xs">App Store</div>
                            </div>
                        </a>
                        {% endif %}
                        {% if system_settings.google_play_link %}
                        <a href="{{ system_settings.google_play_link }}" class="block w-full bg-gray-900 text-white rounded-lg px-4 py-2 flex items-center hover:bg-gray-800 transition-colors">
                            <i class="fab fa-google-play text-xl ml-3"></i>
                            <div class="text-right">
                                <div class="text-[10px] leading-none text-gray-400">حمل من</div>
                                <div class="font-bold text-xs">Google Play</div>
                            </div>
                        </a>
                        {% endif %}
                    </div>
                    <div class="mt-4 pt-4 border-t border-gray-100">
                        <div class="flex items-center space-x-2 space-x-reverse text-gray-400">
                            <div class="flex flex-col items-center">
                                <i class="fas fa-certificate text-xl mb-0"></i>
                                <span class="text-xs font-bold">معروف</span>
                            </div>
                            <div class="flex flex-col items-center">
                                <i class="fas fa-file-invoice-dollar text-xl mb-0"></i>
                                <span class="text-xs font-bold">الضريبة</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endif %}
            </div>

            <!-- Bottom Footer: Rights & Payments -->
            <div class="mt-6 pt-4 border-t border-gray-100 flex flex-col md:flex-row justify-between items-center text-xs">
                <p class="text-gray-400 mb-2 md:mb-0">© {% now "Y" %} {{ system_settings.site_name|default:"متجرك الرقمي" }}. جميع الحقوق محفوظة.</p>
         
            </div>
        </div>
    </footer>
    {% endblock footer %}

    <!-- JavaScript Libraries -->
    <!-- Load non-blocking: defer external libs so parsing isn't blocked. Keep execution order (jQuery before code that expects it). -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" defer></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" defer></script>
    
    <!-- Main Base JS (Extracted) -->
    <script src="{% static 'js/main_base.js' %}?v={{ css_version }}" defer></script>

    {% block extra_js %}{% endblock %}
    {% include 'includes/bottom_nav.html' %}
</body>