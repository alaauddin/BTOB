{% extends 'base.html' %}
{% load cart_filters %}

{% block title %}
    {{ product.name }} - Product Detail
{% endblock %}

{% block content %}
<div class="min-h-screen bg-gray-50 py-8" dir="rtl">
    <div class="container mx-auto px-4 max-w-6xl text-right">
        <!-- Breadcrumb -->
        <nav class="mb-8 text-sm text-gray-600">
            <ol class="flex flex-row-reverse space-x-2 space-x-reverse">
                <li><a href="/" class="hover:text-blue-500 transition-colors">الرئيسية</a></li>
                <li><span class="mx-2">/</span></li>
                <li><a href="#" class="hover:text-blue-500 transition-colors">المنتجات</a></li>
                <li><span class="mx-2">/</span></li>
                <li class="text-gray-400 truncate">{{ product.name }}</li>
            </ol>
        </nav>

        <div class="flex flex-col lg:flex-row bg-white rounded-2xl shadow-xl overflow-hidden transform hover:shadow-2xl transition-all duration-300">
            <!-- Product Image -->
            <div class="lg:w-1/2 relative">
                <img src="{{ product.image.url }}" alt="{{ product.name }}" 
                     class="w-full h-96 lg:h-full object-cover transition-transform duration-500 hover:scale-105">
                
                <!-- Favorite Button -->
                <button class="wishlist-btn absolute top-4 left-4 bg-white p-2 rounded-full shadow-md transition-colors" 
                        title="إضافة للمفضلة" data-product-id="{{ product.id }}" aria-pressed="false">
                    <i class="far fa-heart text-gray-400"></i>
                </button>
            </div>

            <!-- Product Details -->
            <div class="lg:w-1/2 p-8 flex flex-col justify-between">
                <div>
                    <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4">{{ product.name }}</h1>
                    
                    <div class="flex items-center mb-6 justify-start">
                        <div class="flex ml-2">
                            {% for i in '12345'|make_list %}
                                {% if forloop.counter <= product.get_average_rating %}
                                    <svg class="w-6 h-6 fill-current text-yellow-500" viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>
                                    </svg>
                                {% else %}
                                    <svg class="w-6 h-6 fill-current text-gray-300" viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>
                                    </svg>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <span class="text-gray-600 text-lg">{{ product.get_average_rating|floatformat:1 }} ({{ product.get_total_reviews }} تقييم)</span>
                    </div>

                    <p class="text-gray-700 text-lg leading-relaxed mb-8">{{ product.description }}</p>
                </div>

                <div>
                    <div class="flex items-center mb-6">
                        <span class="price-supplier font-bold text-4xl">{{ product.price }} ريال</span>
                        {% if product.old_price %}
                            <span class="mr-4 text-gray-500 text-xl line-through">{{ product.old_price }} ريال</span>
                            <span class="mr-4 bg-red-100 text-red-600 px-2 py-1 rounded-md text-sm font-semibold">
                                خصم {{ product.get_discount_percentage }}%
                            </span>
                        {% endif %}
                    </div>

                    {% with cart.cart_items.all|get_cart_item:product as cart_item %}
                    <div class="flex space-x-4 space-x-reverse mb-8">
                        <div class="flex items-center border rounded-lg px-4 py-2">
                            <button class="text-gray-500 hover:text-gray-700 decrement-btn">-</button>
                            <input type="number" value="{% if cart_item %}{{ cart_item.quantity }}{% else %}1{% endif %}" min="1" class="w-16 text-center mx-2 border-none focus:ring-0 quantity-input">
                            <button class="text-gray-500 hover:text-gray-700 increment-btn">+</button>
                        </div>
                        
                        <button 
                            type="button"
                            class="flex-1 btn-supplier-primary text-white px-8 py-3 rounded-lg font-semibold transition-all transform hover:-translate-y-1 shadow-lg hover:shadow-xl flex items-center justify-center"
                            data-product-id="{{ product.id }}"
                            data-supplier-id="{{ product.supplier.id|default:supplier.id }}"
                            aria-label="أضف إلى السلة">
                             <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                 <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z" />
                             </svg>
                            أضف إلى السلة
                         </button>
                    </div>
                    {% endwith %}

                    <div class="border-t pt-6">
                        <div class="grid grid-cols-2 gap-4 text-sm text-gray-600">
                            <div class="flex items-center justify-end">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                متوفر
                            </div>
                            <div class="flex items-center justify-end">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                شحن مجاني
                            </div>
                            <div class="flex items-center justify-end">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                إرجاع خلال 30 يوم
                            </div>
                            <div class="flex items-center justify-end">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 ml-2 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                                </svg>
                                دفع آمن
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Additional Information Tabs -->
        <div class="mt-12 bg-white rounded-2xl shadow-lg overflow-hidden">
            <div class="border-b">
                <nav class="flex -mb-px">
                    <button class="py-4 px-6 text-center border-b-2 font-medium tab-button active" data-tab="description">
                        الوصف
                    </button>
                    <button class="py-4 px-6 text-center border-b-2 font-medium text-gray-500 hover:text-gray-700 tab-button" data-tab="reviews">
                        التقييمات ({{ product.get_total_reviews }})
                    </button>
                    <button class="py-4 px-6 text-center border-b-2 font-medium text-gray-500 hover:text-gray-700 tab-button" data-tab="shipping">
                        الشحن والإرجاع
                    </button>
                </nav>
            </div>
            
            <div class="p-6 tab-content" id="description-content">
                <p class="text-gray-700 leading-relaxed">{{ product.description }}</p>
                <!-- Additional description content would go here -->
            </div>
            
            <div class="p-6 tab-content hidden" id="reviews-content">
                <h3 class="text-xl font-semibold mb-4">آراء العملاء</h3>
                <!-- Reviews would be dynamically inserted here -->
                 {% for review in product.review_set.all %}
                 <div class="border-b border-gray-200 py-4">
                     <h4 class="font-semibold">{{ review.user.username }}</h4>
                     <p class="text-gray-600">{{ review.comment }}</p>
                     <div class="flex items-center gap-2 mt-2 justify-start">
                        <div class="flex items-center gap-1" aria-hidden="true">
                            {% for i in '12345'|make_list %}
                                {% if forloop.counter <= review.rating %}
                                    <svg class="w-5 h-5 fill-current text-yellow-500" viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>
                                    </svg>
                                {% else %}
                                    <svg class="w-5 h-5 fill-current text-gray-300" viewBox="0 0 24 24" aria-hidden="true">
                                        <path d="M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z"></path>
                                    </svg>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <span class="text-gray-600 text-sm">التقييم: <span class="font-semibold">{{ review.rating }}</span></span>
                    </div>
                 </div>
                 {% empty %}
                 
                     <p class="text-gray-600 italic">لا توجد تقييمات بعد. كن أول من يقيّم هذا المنتج!</p>
                    {% endfor %}
            </div>
            
            <div class="p-6 tab-content hidden" id="shipping-content">
                <h3 class="text-xl font-semibold mb-4">معلومات الشحن</h3>
                <p class="text-gray-700 mb-4">نوفر شحنًا قياسيًا مجانيًا على جميع الطلبات. يستغرق التسليم عادةً 3-5 أيام عمل.</p>
                <h3 class="text-xl font-semibold mb-4">سياسة الإرجاع</h3>
                <p class="text-gray-700">غير راضٍ عن مشترياتك؟ يمكنك إرجاعها خلال 30 يومًا لاسترداد كامل المبلغ. يجب أن تكون العناصر في حالتها الأصلية.</p>
            </div>
        </div>
    </div>
</div>

<style>
    .quantity-input::-webkit-outer-spin-button,
    .quantity-input::-webkit-inner-spin-button {
        -webkit-appearance: none;
        margin: 0;
    }
    
    .quantity-input {
        -moz-appearance: textfield;
    }
</style>

<script>
    // Quantity increment/decrement (robust)
    document.querySelectorAll('.increment-btn').forEach(button => {
        button.addEventListener('click', () => {
            const input = button.parentNode.querySelector('.quantity-input');
            let val = parseInt(input.value, 10);
            if (isNaN(val) || val < 1) val = 0;
            input.value = val + 1;
            input.dispatchEvent(new Event('input', { bubbles: true }));

            // find the add-to-cart button in the same block to get ids
            const block = button.closest('.flex.space-x-4') || button.parentNode.parentNode;
            const addBtn = block ? block.querySelector('[data-product-id][data-supplier-id]') : null;
            if (addBtn) {
                // Prefer global window.addToCart (from base.html) when available, otherwise fall back to local addToCart
                try {
                    if (typeof window.addToCart === 'function') {
                        window.addToCart(addBtn.dataset.productId, addBtn.dataset.supplierId);
                    } else if (typeof addToCart === 'function') {
                        addToCart(addBtn.dataset.productId, addBtn.dataset.supplierId);
                    }
                } catch (e) { /* ignore */ }
            }
        });
    });
    
    document.querySelectorAll('.decrement-btn').forEach(button => {
        button.addEventListener('click', () => {
            const input = button.parentNode.querySelector('.quantity-input');
            let val = parseInt(input.value, 10);
            if (isNaN(val) || val <= 1) {
                input.value = 1;
                input.dispatchEvent(new Event('input', { bubbles: true }));

                // call server decrement: prefer global subToCart
                const block = button.closest('.flex.space-x-4') || button.parentNode.parentNode;
                const addBtn = block ? block.querySelector('[data-product-id][data-supplier-id]') : null;
                if (addBtn) {
                    try {
                        if (typeof window.subToCart === 'function') {
                            window.subToCart(addBtn.dataset.productId, addBtn.dataset.supplierId);
                        } else if (typeof subFromCart === 'function') {
                            subFromCart(addBtn.dataset.productId, addBtn.dataset.supplierId);
                        }
                    } catch (e) { /* ignore */ }
                }
                return;
            }
            input.value = val - 1;
            input.dispatchEvent(new Event('input', { bubbles: true }));

            const block = button.closest('.flex.space-x-4') || button.parentNode.parentNode;
            const addBtn = block ? block.querySelector('[data-product-id][data-supplier-id]') : null;
            if (addBtn) {
                try {
                    if (typeof window.subToCart === 'function') {
                        window.subToCart(addBtn.dataset.productId, addBtn.dataset.supplierId);
                    } else if (typeof subFromCart === 'function') {
                        subFromCart(addBtn.dataset.productId, addBtn.dataset.supplierId);
                    }
                } catch (e) { /* ignore */ }
            }
        });
    });

    // Ensure manual edits respect minimum
    document.querySelectorAll('.quantity-input').forEach(input => {
        input.addEventListener('input', () => {
            let v = parseInt(input.value, 10);
            if (isNaN(v) || v < 1) input.value = 1;
        });
    });

    // Helper: get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }

    // Minimal toast utility
    function createToastContainer() {
        let container = document.getElementById('toast-container');
        if (!container) {
            container = document.createElement('div');
            container.id = 'toast-container';
            container.style.position = 'fixed';
            container.style.top = '1rem';
            container.style.left = '50%';
            container.style.transform = 'translateX(-50%)';
            container.style.zIndex = '9999';
            document.body.appendChild(container);
        }
        return container;
    }

    function showToast(message, type = 'info') {
        const container = createToastContainer();
        const msg = document.createElement('div');
        msg.textContent = message;
        msg.style.background = type === 'success' ? '#10b981' : type === 'error' ? '#ef4444' : '#2563eb';
        msg.style.color = 'white';
        msg.style.padding = '8px 14px';
        msg.style.borderRadius = '8px';
        msg.style.marginTop = '8px';
        msg.style.boxShadow = '0 6px 18px rgba(0,0,0,0.12)';
        container.appendChild(msg);
        setTimeout(() => {
            msg.style.opacity = '0';
            setTimeout(() => container.removeChild(msg), 400);
        }, 2200);
    }

    // Wishlist toggle
    function toggleWishlist(productId, btn) {
        const csrf = getCookie('csrftoken');
        btn.disabled = true;
        fetch(`/wishlist/toggle/${productId}/`, {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrf,
                'X-Requested-With': 'XMLHttpRequest'
            },
            credentials: 'same-origin'
        })
        .then(r => r.json())
        .then(data => {
            if (data && data.success) {
                if (data.in_wishlist) {
                    btn.classList.add('active');
                    btn.querySelector('i').className = 'fas fa-heart text-red-500';
                    btn.setAttribute('aria-pressed', 'true');
                    showToast('تمت الإضافة للمفضلة', 'success');
                } else {
                    btn.classList.remove('active');
                    btn.querySelector('i').className = 'far fa-heart text-gray-400';
                    btn.setAttribute('aria-pressed', 'false');
                    showToast('تمت الإزالة من المفضلة', 'info');
                }
            } else {
                showToast('فشل تحديث المفضلة', 'error');
            }
        })
        .catch(() => showToast('خطأ في الاتصال', 'error'))
        .finally(() => btn.disabled = false);
    }

    function loadWishlistStatus(productId, btn) {
        fetch(`/wishlist/status/${productId}/`, {
            method: 'GET',
            headers: {'X-Requested-With':'XMLHttpRequest'},
            credentials: 'same-origin'
        })
        .then(response => {
            const contentType = response.headers.get('content-type') || '';
            if (!contentType.includes('application/json')) return { success: false };
            return response.json();
        })
        .then(data => {
            if (data && data.success && data.in_wishlist) {
                btn.classList.add('active');
                btn.querySelector('i').className = 'fas fa-heart text-red-500';
                btn.setAttribute('aria-pressed', 'true');
            } else {
                btn.querySelector('i').className = 'far fa-heart text-gray-400';
                btn.setAttribute('aria-pressed', 'false');
            }
        })
        .catch(() => {});
    }

    // Add to cart via AJAX
    function addToCart(productId, supplierOrEvent, maybeEvent) {
        // Normalize parameters: supplierOrEvent may be supplierId or an Event
        let supplierId = '';
        let ev = null;
        if (supplierOrEvent && (typeof supplierOrEvent === 'object') && (supplierOrEvent instanceof Event || supplierOrEvent.type)) {
            ev = supplierOrEvent;
            supplierId = ev.currentTarget?.dataset?.supplierId || document.querySelector('[data-supplier-id]')?.dataset?.supplierId || '';
        } else {
            supplierId = supplierOrEvent || '';
            ev = maybeEvent || null;
        }

        const button = ev ? ev.currentTarget : (document.querySelector(`[data-product-id='${productId}'][data-supplier-id]`) || document.querySelector(`[data-product-id='${productId}']`));
        const qtyInput = document.querySelector('.quantity-input');
        const quantity = qtyInput ? parseInt(qtyInput.value) || 1 : 1;
        const csrf = getCookie('csrftoken');

        if (!supplierId) {
            showToast('معرف البائع غير متوفر. حاول مرة أخرى.', 'error');
            if (button) button.disabled = false;
            return;
        }

        if (button) button.disabled = true;

        // Use the server endpoint that expects product and supplier in the URL
        const url = `/add_to_cart/${productId}/${supplierId}/`;

        fetch(url, {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrf,
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ quantity: quantity })
        })
        .then(r => r.json())
        .then(data => {
            if (data && data.success) {
                showToast('تمت إضافة المنتج للسلة', 'success');
                const badge = document.querySelector('.floating-cart-badge');
                if (badge) {
                    const current = parseInt(badge.textContent) || 0;
                    badge.textContent = current + quantity;
                }
                // small visual feedback
                try { animateCartElement(); } catch (e) { /* ignore */ }
            } else {
                showToast(data && data.message ? data.message : 'فشل في إضافة المنتج', 'error');
            }
        })
        .catch(() => showToast('خطأ في الاتصال', 'error'))
        .finally(() => { if (button) button.disabled = false; });
    }

    // Decrement (sub) endpoint caller
    function subFromCart(productId, supplierId) {
        const qtyInput = document.querySelector('.quantity-input');
        const quantity = qtyInput ? parseInt(qtyInput.value) || 1 : 1;
        const csrf = getCookie('csrftoken');
        const url = `/sub_to_cart/${productId}/${supplierId}/`;

        // Disable the related add-to-cart button while request is in-flight
        const button = document.querySelector(`[data-product-id='${productId}'][data-supplier-id='${supplierId}']`);
        if (button) button.disabled = true;

        fetch(url, {
            method: 'POST',
            credentials: 'same-origin',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRFToken': csrf,
                'X-Requested-With': 'XMLHttpRequest'
            },
            body: JSON.stringify({ quantity: quantity })
        })
        .then(r => r.json())
        .then(data => {
            if (data && data.success) {
                showToast('تم تحديث كمية المنتج', 'success');
                const badge = document.querySelector('.floating-cart-badge');
                if (badge) {
                    const current = parseInt(badge.textContent) || 0;
                    // decrease badge by 1 but never below 0
                    badge.textContent = Math.max(0, current - 1);
                }
                try { animateCartElement(); } catch (e) {}
            } else {
                showToast(data && data.message ? data.message : 'فشل في تحديث السلة', 'error');
            }
        })
        .catch(() => showToast('خطأ في الاتصال', 'error'))
        .finally(() => { if (button) button.disabled = false; });
    }

    // Simple cart badge animation used by other scripts
    function animateCartElement() {
        const badge = document.querySelector('.floating-cart-badge');
        if (!badge) return;
        badge.style.transition = 'transform 260ms cubic-bezier(.2,.8,.2,1)';
        badge.style.transform = 'scale(1.25)';
        setTimeout(() => { badge.style.transform = ''; }, 260);
    }

    // Hook wishlist button and addToCart buttons on DOM ready
    document.addEventListener('DOMContentLoaded', function() {
        // attach wishlist
        const wishBtn = document.querySelector('.wishlist-btn');
        if (wishBtn) {
            const pid = wishBtn.dataset.productId;
            {% if user.is_authenticated %}
            loadWishlistStatus(pid, wishBtn);
            {% endif %}
            wishBtn.addEventListener('click', function(e) {
                {% if user.is_authenticated %}
                toggleWishlist(pid, wishBtn);
                {% else %}
                // show login prompt if user not authenticated
                showToast('سجل الدخول لإدارة المفضلة', 'info');
                {% endif %}
            });
        }

        // attach addToCart handler to button(s) and pass supplier id explicitly
        document.querySelectorAll('[data-product-id][data-supplier-id]').forEach(btn => {
            btn.addEventListener('click', function(e) {
                addToCart(this.dataset.productId, this.dataset.supplierId, e);
            });
        });
    });

    // Tab functionality
    document.querySelectorAll('.tab-button').forEach(button => {
        button.addEventListener('click', () => {
            // Remove active class from all tabs
            document.querySelectorAll('.tab-button').forEach(btn => {
                btn.classList.remove('active', 'border-blue-500', 'text-blue-600');
                btn.classList.add('border-transparent', 'text-gray-500');
            });
            
            // Add active class to clicked tab
            button.classList.add('active', 'border-blue-500', 'text-blue-600');
            button.classList.remove('border-transparent', 'text-gray-500');
            
            // Hide all tab content
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.add('hidden');
            });
            
            // Show selected tab content
            const tabId = button.getAttribute('data-tab');
            document.getElementById(`${tabId}-content`).classList.remove('hidden');
        });
    });
</script>
{% endblock %}

{% block extra_css %}
<style>
:root {
    --primary-color: {{ supplier.primary_color|default:'#2563eb' }};
    --secondary-color: {{ supplier.secondary_color|default:'rgb(135, 219, 255)' }};
    --accent-color: {{ supplier.primary_color|default:'#2563eb' }};

    --primary-gradient: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
}

/* Price using supplier primary color */
.price-supplier {
    color: var(--primary-color) !important;
}

/* Supplier themed add-to-cart button */
.btn-supplier-primary {
    background: var(--primary-gradient);
    border: none;
    border-radius: 12px;
    padding: 12px 20px;
    font-weight: 700;
    letter-spacing: 0.25px;
    transition: transform 0.25s ease, box-shadow 0.25s ease, filter 0.25s ease;
}

.btn-supplier-primary svg { stroke: rgba(255,255,255,0.95); }

.btn-supplier-primary:hover {
    transform: translateY(-3px);
    filter: brightness(1.02);
    box-shadow: 0 12px 30px rgba(0,0,0,0.12);
}

/* Quantity control colors (subtle accent) */
.decrement-btn, .increment-btn {
    color: var(--primary-color);
}

/* Tabs: neutral by default, accent when active */
.tab-button {
    color: #6b7280; /* neutral */
    border-color: transparent;
    background: transparent;
    cursor: pointer;
    transition: color 0.2s ease, border-color 0.2s ease;
}

.tab-button.active {
    color: var(--primary-color);
    border-bottom-color: var(--primary-color);
    box-shadow: inset 0 -3px 0 var(--primary-color);
    font-weight: 700;
}

.tab-button:hover {
    color: var(--primary-color);
}

/* Tab content typography */
.tab-content p { color: #374151; }

/* Ensure form inputs that show numbers remain visible on dark/light backgrounds */
.quantity-input {
    color: #111827;
}

/* Small responsive tweak so the add button stands out on mobile */
@media (max-width: 768px) {
    .btn-supplier-primary { padding: 12px 16px; width: 100%; }
}
</style>
{% endblock %}