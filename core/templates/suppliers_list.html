{% extends 'base.html' %}
{% load static %}

{% block title %}عرطات دوتكم{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/suppliers.css' %}">
{% endblock %}

{% block content %}
<!-- Modern Hero Section -->


<div class=" pt-4">
    <!-- Platform Offers Ads Section -->
    {% if platform_ads %}
    <div class="platform-ads-section">
        <h2 class="section-title mb-3">عروض عرطات</h2>
        <div class="ads-scroll-container">
            {% for ad in platform_ads %}
            <a href="{% url 'product_detail' ad.product.supplier.store_id ad.product.id %}" class="ad-card-link">
                <div class="ad-card">
                    {% if ad.product.has_discount %}
                    <div class="ad-badge-discount">
                        -{{ ad.product.get_discount_precentage }}%
                    </div>
                    {% endif %}
                    <div class="ad-badge-hot">
                        <i class="fas fa-fire"></i> عرض حصري
                    </div>
                    <div class="supplier-mini-logo">
                        <img src="{% if ad.product.supplier.profile_picture %}{{ ad.product.supplier.profile_picture.url }}{% else %}{% static 'logo.png' %}{% endif %}" alt="{{ ad.product.supplier.name }}">
                    </div>
                    <div class="ad-image">
                        <img src="{{ ad.product.image.url }}" alt="{{ ad.product.name }}">
                    </div>
                    <div class="ad-info">
                        <div class="ad-supplier-name">{{ ad.product.supplier.name }}</div>
                        <h4 class="ad-product-name">{{ ad.product.name }}</h4>
                        <p class="ad-description">{{ ad.description|truncatewords:10 }}</p>
                        <div class="ad-price">
                            <span class="final-price">{{ ad.product.get_price_with_offer|floatformat:0 }} {{ ad.product.supplier.currency }}</span>
                            {% if ad.product.has_discount %}
                            <span class="original-price" style="text-decoration: line-through; color: #94a3b8; font-size: 0.9rem; margin-right: 8px;">{{ ad.product.price|floatformat:0 }}</span>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}


    <!-- Filter & Categories -->
<div class="category-nav-wrapper">
    <div class="container">
        <span class="filter-label">استكشف عبر التصنيفات</span>
        <div class="category-scroll-container">
            <button class="category-pill active" data-category="all" onclick="filterByCategory('all')">
                <i class="fas fa-border-all"></i>
                <span>الكل</span>
            </button>
            {% for category in categories %}
            <button class="category-pill" data-category="{{ category.id }}" onclick="filterByCategory('{{ category.id }}')">
               
                    <i class="fas fa-tag"></i>
                <span>{{ category.name }}</span>
            </button>
            {% endfor %}
        </div>
    </div>
</div>

    <!-- Suppliers Grid -->
    <div class="supplier-grid">
        <div class="supplier-horizontal-scroll" id="supplierGrid">
            {% for supplier in suppliers %}
            <div class="supplier-card-container" data-categories="{% for cat in supplier.category.all %}{{ cat.id }},{% endfor %}">
                <div class="supplier-card relative group">
                    {% if request.user.is_superuser %}
                    <a href="{% url 'my_merchant' %}?supplier_id={{ supplier.id }}" class="absolute top-2 left-2 z-10 w-8 h-8 flex items-center justify-center bg-white/90 backdrop-blur-sm text-gray-700 rounded-full shadow-sm hover:bg-red-500 hover:text-white transition-all transform hover:scale-110" title="إدارة المتجر">
                        <i class="fas fa-cog text-sm"></i>
                    </a>
                    {% endif %}
                    <div class="supplier-cover" style="{% if supplier.panal_picture %}background-image: url('{{ supplier.panal_picture.url }}'); background-size: cover; background-position: center;{% else %}background-color: {{ supplier.primary_color }}22;{% endif %}"></div>
                    <div class="supplier-logo-wrapper">
                        <img src="{% if supplier.profile_picture %}{{ supplier.profile_picture.url }}{% else %}{% static 'logo.png' %}{% endif %}" alt="{{ supplier.name }}">
                    </div>
                    
                    <div class="supplier-content">
                        <h3 class="supplier-name">{{ supplier.name }}</h3>
                        
                        <div class="supplier-meta">
                            <i class="fas fa-map-marker-alt"></i>
                            <span>{{ supplier.city }}, {{ supplier.country }}</span>
                        </div>
                        
                        <div class="supplier-tags">
                            {% for category in supplier.category.all %}
                                <span class="supplier-tag">{{ category.name }}</span>
                            {% endfor %}
                        </div>

                       

                        <div class="supplier-footer">
                            <div class="rating-box">
                                <i class="fas fa-star text-warning"></i>
                                <span class="fw-bold ms-1">{{ supplier.get_average_rating|default:"5.0" }}</span>
                            </div>
                            <button class="btn-visit" onclick="window.location='{% url 'product-list' supplier.store_id %}'">
                                <span>زيارة المتجر</span>
                                <i class="fas fa-arrow-left me-2"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
            {% empty %}
            <div class="col-12 w-full">
                <div class="no-suppliers">
                    <i class="fas fa-store-slash"></i>
                    <h3>لا توجد متاجر متاحة حالياً</h3>
                    <p class="text-muted">لم يتم العثور على أي متاجر تتوافق مع بحثك</p>
                </div>
            </div>
            {% endfor %}
        </div>
    </div>
</div>

    {% if producing_family_suppliers %}
    <div class="producing-families-wrapper">
        <div class="container pt-4">
            <h2 class="section-title mb-1">متاجر الاسر المنتجة</h2>
        </div>
        <div class="suppliers-scroll-container">
            {% for s in producing_family_suppliers %}
            <a href="{% url 'product-list' s.store_id %}" class="supplier-card-link-premium">
                <div class="supplier-card-premium">
                    <div class="home-badge">
                        <i class="fas fa-home"></i>
                    </div>
                    <div class="supplier-logo-container">
                        <img src="{% if s.profile_picture %}{{ s.profile_picture.url }}{% else %}{% static 'logo.png' %}{% endif %}" alt="{{ s.name }}">
                    </div>
                    <div class="supplier-info-glass">
                        <div class="supplier-name-premium">{{ s.name }}</div>
                        <div class="home-label">إنتاج منزلي</div>
                        <div class="supplier-stats-mini mt-1 d-flex gap-2">
                             <div class="stat-mini text-white" style="font-size: 0.65rem; opacity: 0.9;">
                                <i class="fas fa-eye text-white opacity-75"></i> {{ s.views_count|default:"0" }}
                            </div>
                            <div class="stat-mini text-white" style="font-size: 0.65rem; opacity: 0.9;">
                                <i class="fas fa-shopping-bag text-white opacity-75"></i> {{ s.get_total_sales_count }}
                            </div>
                        </div>
                    </div>
                </div>
            </a>
            {% endfor %}
        </div>
    </div>
    {% endif %}

    <!-- Join as Business Section -->
    <section class="business-join-wrapper">
        <div class="container">
            <div class="business-join-card">
                <div class="business-join-header">
                    <h2>انضم إلينا كشريك نجاح</h2>
                    <p>هل تمتلك نشاطاً تجارياً وترغب في زيادة مبيعاتك؟ انضم إلى منصتنا اليوم واعرض منتجاتك لآلاف العملاء.</p>
                </div>

                <form method="POST" class="business-request-form">
                    {% csrf_token %}
                    <div class="business-form-grid">
                        <div class="form-group">
                            <label class="business-form-label">{{ business_form.name.label }}</label>
                            {{ business_form.name }}
                        </div>
                        <div class="form-group">
                            <label class="business-form-label">{{ business_form.owner_name.label }}</label>
                            {{ business_form.owner_name }}
                        </div>
                        <div class="form-group">
                            <label class="business-form-label">{{ business_form.email.label }}</label>
                            {{ business_form.email }}
                        </div>
                        <div class="form-group">
                            <label class="business-form-label">{{ business_form.phone.label }}</label>
                            {{ business_form.phone }}
                        </div>
                        <div class="form-group-full">
                            <label class="business-form-label">{{ business_form.business_type.label }}</label>
                            {{ business_form.business_type }}
                        </div>
                        <div class="form-group-full">
                            <label class="business-form-label">{{ business_form.message.label }}</label>
                            {{ business_form.message }}
                        </div>
                    </div>
                    <button type="submit" class="btn-submit-business">
                        <span>إرسال طلب الانضمام</span>
                        <i class="fas fa-paper-plane me-2"></i>
                    </button>
                </form>
            </div>
        </div>
    </section>

<script>
function filterByCategory(categoryId) {
    const cards = document.querySelectorAll('.supplier-card-container');
    const buttons = document.querySelectorAll('.category-pill');
    
    buttons.forEach(btn => {
        if (btn.getAttribute('data-category') === categoryId) {
            btn.classList.add('active');
        } else {
            btn.classList.remove('active');
        }
    });

    cards.forEach(card => {
        if (categoryId === 'all') {
            card.style.display = 'block';
        } else {
            const categories = card.getAttribute('data-categories').split(',');
            if (categories.includes(categoryId)) {
                card.style.display = 'block';
            } else {
                card.style.display = 'none';
            }
        }
    });
}
</script>
{% endblock %}